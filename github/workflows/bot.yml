name: Telegram Bot 24/7

on:
  schedule:
    - cron: '*/5 * * * *'  # –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Setup Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        
    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y chromium-browser chromium-chromedriver
        
    - name: Create data directory
      run: mkdir -p data
      
    - name: Run Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        SCHEDULE_URL: https://edu.tgpi.ru
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
        go run main.go &
        BOT_PID=$!
        echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å PID: $BOT_PID"
        
        # –î–µ—Ä–∂–∏–º –±–æ—Ç–∞ –∂–∏–≤—ã–º 5 –º–∏–Ω—É—Ç
        sleep 280
        
        # –£–±–∏–≤–∞–µ–º –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–ø—É—Å–∫–æ–º
        kill $BOT_PID 2>/dev/null || true
        echo "‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∂–¥–µ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞..."
