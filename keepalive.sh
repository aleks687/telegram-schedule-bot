#!/bin/bash

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
run_bot() {
    echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
    go run main.go &
    BOT_PID=$!
    echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —Å PID: $BOT_PID"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
check_bot() {
    if ! kill -0 $BOT_PID 2>/dev/null; then
        echo "‚ùå –ë–æ—Ç —É–º–µ—Ä, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º..."
        return 1
    fi
    return 0
}

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
echo "üîÑ –ó–∞–ø—É—Å–∫ keepalive —Å–∫—Ä–∏–ø—Ç–∞..."

# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
run_bot

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏
while true; do
    if ! check_bot; then
        run_bot
    fi
    sleep 60  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
done